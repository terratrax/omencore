<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:OmenCore.Avalonia.ViewModels"
             x:Class="OmenCore.Avalonia.Views.FanControlView"
             x:DataType="vm:FanControlViewModel">
    
    <ScrollViewer>
        <StackPanel Spacing="16">
            
            <!-- Page Header -->
            <TextBlock Classes="pageHeader" Text="Fan Control" />
            <TextBlock Classes="label" Text="Custom fan curves and presets" Margin="0,-4,0,12" />
            
            <!-- Current Status -->
            <UniformGrid Rows="1" Columns="4">
                <Border Classes="statCard" Margin="0,0,8,0">
                    <StackPanel>
                        <TextBlock Classes="label" Text="CPU Temp" />
                        <TextBlock Classes="value" Text="{Binding CpuTemperature, StringFormat={}{0:F1}°C}" />
                    </StackPanel>
                </Border>
                <Border Classes="statCard" Margin="4,0">
                    <StackPanel>
                        <TextBlock Classes="label" Text="GPU Temp" />
                        <TextBlock Classes="value" Text="{Binding GpuTemperature, StringFormat={}{0:F1}°C}" />
                    </StackPanel>
                </Border>
                <Border Classes="statCard" Margin="4,0">
                    <StackPanel>
                        <TextBlock Classes="label" Text="CPU Fan" />
                        <TextBlock Classes="value" Text="{Binding CpuFanRpm, StringFormat={}{0} RPM}" />
                    </StackPanel>
                </Border>
                <Border Classes="statCard" Margin="8,0,0,0">
                    <StackPanel>
                        <TextBlock Classes="label" Text="GPU Fan" />
                        <TextBlock Classes="value" Text="{Binding GpuFanRpm, StringFormat={}{0} RPM}" />
                    </StackPanel>
                </Border>
            </UniformGrid>
            
            <!-- Preset Selection -->
            <Border Classes="card" Margin="0,8,0,0">
                <StackPanel>
                    <TextBlock Classes="sectionHeader" Text="Fan Presets" />
                    <StackPanel Orientation="Horizontal" Spacing="8" Margin="0,8,0,0">
                        <ComboBox ItemsSource="{Binding Presets}" 
                                  SelectedItem="{Binding SelectedPreset}"
                                  MinWidth="150" />
                        <Button Classes="secondary" Content="Apply Preset" 
                                Command="{Binding LoadPresetCommand}"
                                CommandParameter="{Binding SelectedPreset}" />
                    </StackPanel>
                </StackPanel>
            </Border>
            
            <!-- Custom Fan Curve Toggle -->
            <Border Classes="card">
                <StackPanel Orientation="Horizontal" Spacing="16">
                    <ToggleSwitch IsChecked="{Binding IsCustomCurveEnabled}" 
                                  OnContent="Custom Curve Enabled"
                                  OffContent="Custom Curve Disabled" />
                    <ToggleSwitch IsChecked="{Binding LinkFans}"
                                  OnContent="Fans Linked"
                                  OffContent="Fans Independent" />
                </StackPanel>
            </Border>
            
            <!-- Fan Curve Editor -->
            <Grid ColumnDefinitions="*,*" IsVisible="{Binding IsCustomCurveEnabled}">
                
                <!-- CPU Fan Curve -->
                <Border Classes="card" Grid.Column="0" Margin="0,0,8,0">
                    <StackPanel>
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,12">
                            <TextBlock Classes="sectionHeader" Text="CPU Fan Curve" />
                            <Button Classes="secondary" Content="+" 
                                    Command="{Binding AddCpuPointCommand}"
                                    Margin="12,0,0,0" Padding="8,4" />
                        </StackPanel>
                        
                        <ItemsControl ItemsSource="{Binding CpuFanCurve}">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate x:DataType="vm:FanCurvePointViewModel">
                                    <Border Background="#252525" CornerRadius="4" Padding="12,8" Margin="0,4">
                                        <Grid ColumnDefinitions="*,*,Auto">
                                            <StackPanel Grid.Column="0" Margin="0,0,8,0">
                                                <TextBlock Classes="label" Text="Temperature (°C)" />
                                                <NumericUpDown Value="{Binding Temperature}" 
                                                               Minimum="30" Maximum="100"
                                                               Increment="5" />
                                            </StackPanel>
                                            <StackPanel Grid.Column="1" Margin="8,0">
                                                <TextBlock Classes="label" Text="Fan Speed (%)" />
                                                <NumericUpDown Value="{Binding FanSpeed}" 
                                                               Minimum="0" Maximum="100"
                                                               Increment="5" />
                                            </StackPanel>
                                            <Button Grid.Column="2" Content="✕" 
                                                    VerticalAlignment="Bottom"
                                                    Command="{Binding $parent[ItemsControl].((vm:FanControlViewModel)DataContext).RemoveCpuPointCommand}"
                                                    CommandParameter="{Binding}"
                                                    Padding="8,4" />
                                        </Grid>
                                    </Border>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </StackPanel>
                </Border>
                
                <!-- GPU Fan Curve -->
                <Border Classes="card" Grid.Column="1" Margin="8,0,0,0">
                    <StackPanel>
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,12">
                            <TextBlock Classes="sectionHeader" Text="GPU Fan Curve" />
                            <Button Classes="secondary" Content="+" 
                                    Command="{Binding AddGpuPointCommand}"
                                    Margin="12,0,0,0" Padding="8,4" />
                        </StackPanel>
                        
                        <ItemsControl ItemsSource="{Binding GpuFanCurve}">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate x:DataType="vm:FanCurvePointViewModel">
                                    <Border Background="#252525" CornerRadius="4" Padding="12,8" Margin="0,4">
                                        <Grid ColumnDefinitions="*,*,Auto">
                                            <StackPanel Grid.Column="0" Margin="0,0,8,0">
                                                <TextBlock Classes="label" Text="Temperature (°C)" />
                                                <NumericUpDown Value="{Binding Temperature}" 
                                                               Minimum="30" Maximum="100"
                                                               Increment="5" />
                                            </StackPanel>
                                            <StackPanel Grid.Column="1" Margin="8,0">
                                                <TextBlock Classes="label" Text="Fan Speed (%)" />
                                                <NumericUpDown Value="{Binding FanSpeed}" 
                                                               Minimum="0" Maximum="100"
                                                               Increment="5" />
                                            </StackPanel>
                                            <Button Grid.Column="2" Content="✕" 
                                                    VerticalAlignment="Bottom"
                                                    Command="{Binding $parent[ItemsControl].((vm:FanControlViewModel)DataContext).RemoveGpuPointCommand}"
                                                    CommandParameter="{Binding}"
                                                    Padding="8,4" />
                                        </Grid>
                                    </Border>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </StackPanel>
                </Border>
            </Grid>
            
            <!-- Action Buttons -->
            <StackPanel Orientation="Horizontal" Spacing="12" HorizontalAlignment="Right" Margin="0,16,0,0">
                <Button Classes="secondary" Content="Reset to Default" 
                        Command="{Binding ResetToDefaultCommand}" />
                <Button Classes="primary" Content="Apply Fan Curve" 
                        Command="{Binding ApplyCurveCommand}" />
            </StackPanel>
            
        </StackPanel>
    </ScrollViewer>
</UserControl>
